<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Redirecting...</title>
    <script>
      const redirectUrl = "https://caplanc.org/access-resources/safety-empowerment/domestic-violence-services/";

      // NEW (primary) endpoint
      const newFlowUrl = "https://default1155ce382a364ffaad4da283064efb.68.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/9bcd0e64bcfe47b182626f09806cb9b0/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=dsDZvg20sa-nyx0f571DfnXfEXlMkM6_he0cqU2aUCk";

      // New (Expanded) endpoint â€“ valid until Nov 30, 2025
      const oldFlowUrl = "https://38c0ffbc5b67e3c9bab1502225ae2b.04.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/b21b57c64bbf446289b1d2a5a9685771/triggers/manual/paths/invoke?api-version=1";

      // Cutoff at 11:59:59 PM ET on Nov 30, 2025
      const cutoff = new Date("2025-11-30T23:59:59-05:00");

      (async function () {
        const urlParams = new URLSearchParams(window.location.search);

        const data = {
          Tagname: urlParams.get("Tagname") || "",
          CurrentTime: urlParams.get("CurrentTime") || new Date().toISOString(),
          Department: urlParams.get("Department") || "",
          Location: urlParams.get("Location") || "",
        };

        const post = (url) =>
          fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
          });

        try {
          // 1) Try NEW endpoint first
          await post(newFlowUrl);

          // 2) While before cutoff, also send to OLD (fire-and-forget)
          if (new Date() <= cutoff) post(oldFlowUrl).catch(() => {});
        } catch (err) {
          // If NEW failed and we're before cutoff, try OLD once
          if (new Date() <= cutoff) {
            try { await post(oldFlowUrl); } catch (e) { /* ignore */ }
          }
        } finally {
          // Redirect regardless of outcome
          window.location.href = redirectUrl;
        }
      })();
    </script>
  </head>
  <body>
    Redirecting...
  </body>
</html>

